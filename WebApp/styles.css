/* styles.css — Tirs of Traea */

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #2C2725;
  color: #e0e0e0;
  font-family: 'Segoe UI', system-ui, sans-serif;
  overflow: hidden;
}

canvas {
  display: block;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 0;
}

/* ── Top nav ─────────────────────────────────────────────────── */

#top-nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 40px;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  padding: 0 16px;
  z-index: 200;
}

.nav-title {
  font-size: 15px;
  font-weight: 700;
  color: #ffd700;
  letter-spacing: 0.5px;
}

/* ── Theme toggle buttons ───────────────────────────────────── */

.theme-toggle {
  margin-left: auto;
  display: flex;
  gap: 4px;
}

.btn-theme {
  padding: 4px 10px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 3px;
  background: transparent;
  color: rgba(255,255,255,0.5);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.15s;
}

.btn-theme:hover {
  color: rgba(255,255,255,0.8);
  border-color: rgba(255,255,255,0.3);
}

.btn-theme.active {
  color: #ffd700;
  border-color: rgba(255,215,0,0.5);
  background: rgba(255,215,0,0.1);
}

/* ── Status bar (turn / phase indicator near board) ──────────── */

#status-bar {
  position: fixed;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  padding: 6px 20px;
  border-radius: 20px;
  background: rgba(0,0,0,0.75);
  color: #ffd700;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  z-index: 100;
  pointer-events: none;
}

/* ── Panels ──────────────────────────────────────────────────── */

.phase-panel {
  position: fixed;
  z-index: 50;
  background: rgba(20, 20, 40, 0.92);
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(8px);
  padding: 16px;
  overflow-y: auto;
}

.side-panel {
  top: 48px;
  width: 180px;
  max-height: calc(100vh - 60px);
  border-radius: 8px;
}

.side-panel.side-left,
.side-panel:not(.side-right) {
  left: 8px;
}

.side-panel.side-right {
  left: auto;
  right: 8px;
}

.roster-points-bar {
  position: sticky;
  top: -16px;
  margin: -16px -16px 12px;
  padding: 8px 12px;
  text-align: center;
  background: rgba(20, 20, 40, 0.95);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  z-index: 1;
}

/* Player-colored panels */
.phase-panel.player-1,
#panel-faction-p1 {
  background: rgba(42, 157, 143, 0.2);
  border-color: rgba(42, 157, 143, 0.4);
}

.phase-panel.player-2,
#panel-faction-p2 {
  background: rgba(212, 135, 44, 0.2);
  border-color: rgba(212, 135, 44, 0.4);
}

.center-panel {
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  border-radius: 12px;
  text-align: center;
}

/* ── Rules panel ──────────────────────────────────────────────── */

#panel-rules {
  width: 280px;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  top: 48px;
  transform: translateX(-50%);
}

#panel-rules h2 {
  font-size: 15px;
  margin-bottom: 10px;
}

.rules-form {
  display: flex;
  flex-direction: column;
  gap: 2px;
  text-align: left;
}

.rule-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.rule-label {
  font-size: 11px;
  color: #ccc;
  flex: 1;
}

.rule-input {
  width: 50px;
  padding: 3px 4px;
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  background: rgba(255,255,255,0.08);
  color: #e0e0e0;
  font-size: 12px;
  text-align: center;
}

.rule-input:focus {
  outline: none;
  border-color: #ffd700;
}

.rule-checkbox {
  width: 15px;
  height: 15px;
  accent-color: #ffd700;
  cursor: pointer;
}

/* ── Roster card areas ───────────────────────────────────────── */

.roster-area {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 40;
  pointer-events: none;
}

.unit-card.roster-card {
  position: absolute;
  /* Same 240×336 base, scaled down to 160×224 (factor 0.667) */
  width: 240px;
  height: 336px;
  pointer-events: auto;
  cursor: grab;
  opacity: 0.92;
  transition: opacity 0.15s, box-shadow 0.15s;
  transform-origin: center center;
  z-index: auto;
}

.unit-card.roster-card:active {
  cursor: grabbing;
}

.unit-card.roster-card:hover {
  opacity: 1;
  box-shadow:
    0 4px 24px rgba(0,0,0,0.5),
    0 0 8px rgba(255,255,255,0.15),
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 -1px 0 rgba(0,0,0,0.08);
}

.hidden { display: none !important; }

/* ── Typography ──────────────────────────────────────────────── */

h2 {
  font-size: 18px;
  margin-bottom: 12px;
  color: #ededed;
  border-bottom: 1px solid rgba(255,215,0,0.3);
  padding-bottom: 6px;
}

h3 {
  font-size: 14px;
  margin: 10px 0 6px;
  color: #ccc;
}

p { font-size: 13px; margin: 4px 0; }

.hint { color: #999; font-style: italic; font-size: 12px; }

/* ── Buttons ─────────────────────────────────────────────────── */

.btn {
  display: inline-block;
  padding: 6px 12px;
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  background: rgba(255,255,255,0.08);
  color: #e0e0e0;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.15s, border-color 0.15s;
  text-align: left;
}

.btn:hover:not(:disabled) {
  background: rgba(255,255,255,0.18);
  border-color: rgba(255,255,255,0.4);
}

.btn:disabled {
  opacity: 0.35;
  cursor: default;
}

.btn.selected, .btn.in-roster {
  border-color: #ffd700;
  background: rgba(255,215,0,0.15);
}

/* ── Faction buttons ─────────────────────────────────────────── */

.faction-pick { margin-bottom: 12px; }

.faction-grid {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.btn-faction {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  font-size: 12px;
}

.faction-logo {
  width: 30px;
  height: 30px;
  object-fit: cover;
  flex-shrink: 0;
  border-radius: 50%;
}

/* ── Unit list buttons ───────────────────────────────────────── */

.unit-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 10px;
}

.btn-unit {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 8px 10px;
}

.unit-name { font-weight: 600; }

.unit-stats {
  font-size: 11px;
  color: #aaa;
  white-space: nowrap;
}

.unit-cost { font-size: 11px; color: #ffd700; }

.remove-x { color: #f66; font-size: 12px; }

/* ── Surface buttons ─────────────────────────────────────────── */

.surface-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.btn-surface {
  flex: 0 0 auto;
  padding: 0;
  background: none;
  border: 2px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  line-height: 0;
}

.surface-icon {
  width: 28px;
  height: 28px;
  object-fit: contain;
}

.btn-surface:hover {
  border-color: #ffd700;
}

/* ── Battle UI ───────────────────────────────────────────────── */

.activation-info {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
  padding: 10px;
  margin: 8px 0;
}

.activation-info p { margin-bottom: 8px; }

.btn-action {
  margin: 2px 4px 2px 0;
  padding: 6px 14px;
}

.btn-action:hover:not(:disabled) {
  background: rgba(100,200,100,0.25);
}

.btn-skip:hover:not(:disabled) {
  background: rgba(200,200,100,0.25);
}

.btn-end:hover:not(:disabled) {
  background: rgba(200,100,100,0.25);
}

.done-label {
  display: inline-block;
  padding: 6px 14px;
  font-size: 12px;
  color: #666;
}

.btn-confirm {
  display: block;
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  background: rgba(255,215,0,0.15);
  border-color: #ffd700;
  color: #ffd700;
  font-weight: 600;
  text-align: center;
}

.btn-confirm:hover {
  background: rgba(255,215,0,0.3);
}

.btn-back {
  display: block;
  width: 100%;
  padding: 6px;
  margin-top: 4px;
  background: transparent;
  border-color: rgba(255,255,255,0.2);
  color: rgba(255,255,255,0.6);
  font-size: 11px;
}

.btn-back:hover {
  background: rgba(255,255,255,0.08);
  color: #fff;
}

/* ── Unit card (bg3-inspired parchment style) ────────────────── */

.unit-card {
  position: fixed;
  z-index: 300;
  width: 240px;
  height: 336px;
  border-radius: 3px;
  /* Near-white parchment with warm mottling */
  background-color: #ebe8e2;
  background-image:
    radial-gradient(ellipse at 25% 15%, rgba(250,249,246,0.7), transparent 45%),
    radial-gradient(ellipse at 75% 85%, rgba(210,205,195,0.45), transparent 45%),
    radial-gradient(ellipse at 50% 50%, rgba(230,226,218,0.35), transparent 70%),
    radial-gradient(circle at 15% 70%, rgba(200,195,185,0.3), transparent 30%),
    radial-gradient(circle at 85% 25%, rgba(242,240,236,0.4), transparent 30%),
    radial-gradient(circle at 40% 90%, rgba(195,190,178,0.25), transparent 25%),
    radial-gradient(circle at 70% 10%, rgba(205,200,190,0.2), transparent 20%),
    radial-gradient(ellipse at 10% 40%, rgba(215,210,200,0.2), transparent 35%),
    radial-gradient(ellipse at 90% 60%, rgba(198,193,182,0.2), transparent 35%);
  box-shadow:
    0 4px 20px rgba(0,0,0,0.45),
    inset 0 1px 0 rgba(255,255,255,0.5),
    inset 0 -1px 0 rgba(0,0,0,0.06);
  pointer-events: none;
  font-size: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 6px 8px 5px;
  gap: 3px;
}

/* Paper noise texture overlay */
.unit-card .card-texture {
  position: absolute;
  inset: 0;
  opacity: 0.12;
  filter: url(#paper-noise);
  pointer-events: none;
  z-index: 0;
}
/* Ensure card children sit above texture */
.unit-card > *:not(.card-texture) {
  position: relative;
  z-index: 1;
}

/* ── Notched frame with bevels ── */
.card-notched {
  position: relative;
}

/* Notched border + bevel */
.card-notched::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 1px solid rgba(40,35,28,0.25);
  box-shadow:
    inset 1px 1px 0 rgba(255,255,255,0.3),
    inset -1px -1px 0 rgba(0,0,0,0.08),
    inset 2px 2px 3px rgba(255,255,255,0.05),
    inset -2px -2px 3px rgba(0,0,0,0.04);
  clip-path: polygon(
    4px 0, calc(100% - 4px) 0,
    calc(100% - 4px) 4px, 100% 4px,
    100% calc(100% - 4px), calc(100% - 4px) calc(100% - 4px),
    calc(100% - 4px) 100%, 4px 100%,
    4px calc(100% - 4px), 0 calc(100% - 4px),
    0 4px, 4px 4px
  );
}

/* Small corner triangle outlines at each notch */
.card-notched::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  /* 5×5 SVG triangle outlines. #28231c40 ≈ rgba(40,35,28,0.25) */
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 5 L5 0 L0 0 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 0 0,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 0 L5 0 L5 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 100% 0,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M5 0 L5 5 L0 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 100% 100%,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 0 L5 5 L0 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 0 100%;
}

/* ── Title bar ── */
.unit-card .card-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px 24px;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.12) 0%, transparent 40%, rgba(0,0,0,0.04) 100%);
}

.unit-card .card-name {
  font-weight: 700;
  font-size: 11px;
  color: #28231c;
  text-align: center;
  text-shadow: 0 1px 0 rgba(255,255,255,0.25);
}

.unit-card .card-cost {
  position: absolute;
  left: 7px;
  top: 50%;
  transform: translateY(-50%);
  background:
    radial-gradient(circle, rgba(255,255,255,0.15), rgba(0,0,0,0.04));
  border: 1px solid rgba(40,35,28,0.4);
  border-radius: 50%;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 10px;
  color: #28231c;
  flex-shrink: 0;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.25),
    inset 0 -1px 0 rgba(0,0,0,0.08);
}

/* ── Art area ── */
.unit-card .card-image {
  width: 100%;
  flex: 1 1 0;
  min-height: 0;
  background: #1a1610;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
/* Image needs to stay within bounds but not clip the frame pseudos */
.unit-card .card-image img,
.unit-card .card-image .no-image {
  position: relative;
  z-index: 0;
}

.unit-card .card-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.unit-card .card-image .no-image {
  color: #666;
  font-size: 36px;
  font-weight: 700;
}

.unit-card .card-type {
  padding: 4px 10px;
  font-size: 11px;
  color: #5a5040;
  font-style: italic;
}

/* ── Stats row ── */
.unit-card .card-stats {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  padding: 0;
  margin: -1px 0;
}

.stat-icon {
  width: 22px;
  height: 22px;
  flex-shrink: 0;
}

.stat-num {
  fill: #28231c;
  font-size: 16px;
  font-weight: 700;
  font-family: inherit;
  text-anchor: middle;
  dominant-baseline: central;
  paint-order: stroke fill;
  stroke: rgba(237,234,228,0.9);
  stroke-width: 1.5px;
}

/* ── Rules text box ── */
.unit-card .card-rules {
  padding: 4px 7px;
  font-size: 9px;
  line-height: 1.3;
  color: #2a2218;
  flex: 1 1 0;
  min-height: 0;
  overflow-y: auto;
  background: rgba(0,0,0,0.02);
}

.unit-card .card-rule {
  margin-bottom: 3px;
}
.unit-card .card-rule:last-child {
  margin-bottom: 0;
}

.unit-card .rule-name {
  text-align: center;
  font-weight: 700;
  font-size: 9px;
  color: #28231c;
  text-shadow: 0 1px 0 rgba(255,255,255,0.2);
}

.unit-card .rule-desc {
  font-size: 7.5px;
  color: #000;
  line-height: 1.25;
  text-align: center;
}

.unit-card .card-footer {
  padding: 4px 10px 6px;
  font-size: 10px;
  color: #776a4e;
  text-align: right;
  border-top: 1px solid rgba(40,35,28,0.15);
  font-style: italic;
}

/* ── Faction card textures ─────────────────────────────────── */

/* Syli — bark paper, dappled canopy light */
.unit-card.faction-syli {
  background-color: #d4e8d8;
  background-image:
    radial-gradient(ellipse at 20% 20%, rgba(255,255,230,0.5), transparent 30%),
    radial-gradient(ellipse at 60% 15%, rgba(255,255,220,0.35), transparent 25%),
    radial-gradient(ellipse at 80% 45%, rgba(255,255,230,0.3), transparent 20%),
    radial-gradient(ellipse at 35% 70%, rgba(255,255,220,0.4), transparent 28%),
    radial-gradient(ellipse at 75% 80%, rgba(255,255,230,0.25), transparent 22%),
    radial-gradient(ellipse at 45% 40%, rgba(80,110,70,0.15), transparent 35%),
    radial-gradient(ellipse at 15% 55%, rgba(70,100,60,0.12), transparent 30%),
    radial-gradient(ellipse at 70% 65%, rgba(85,115,75,0.1), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(160,180,140,0.2), transparent 70%);
}
.unit-card.faction-syli .card-texture {
  filter: url(#noise-organic);
  opacity: 0.15;
  mix-blend-mode: multiply;
}

/* Red Ridge — volcanic ash, ember glow */
.unit-card.faction-red-ridge {
  background-color: #ebd5cc;
  background-image:
    radial-gradient(circle at 30% 75%, rgba(255,120,50,0.2), transparent 25%),
    radial-gradient(circle at 70% 25%, rgba(255,100,40,0.15), transparent 20%),
    radial-gradient(circle at 50% 50%, rgba(255,140,60,0.1), transparent 30%),
    radial-gradient(ellipse at 20% 30%, rgba(80,30,20,0.12), transparent 35%),
    radial-gradient(ellipse at 80% 70%, rgba(90,35,25,0.1), transparent 30%),
    radial-gradient(ellipse at 55% 85%, rgba(70,25,15,0.08), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(200,120,80,0.15), transparent 65%),
    linear-gradient(180deg, rgba(255,180,100,0.08) 0%, transparent 40%),
    linear-gradient(0deg, rgba(100,30,20,0.06) 0%, transparent 30%);
}
.unit-card.faction-red-ridge .card-texture {
  filter: url(#noise-volcanic);
  opacity: 0.18;
  mix-blend-mode: multiply;
}

/* Seri — dark otherworldly silk, eerie netherrealm */
.unit-card.faction-seri {
  background-color: #e0cce0;
  background-image:
    radial-gradient(ellipse at 25% 80%, rgba(180,60,180,0.18), transparent 35%),
    radial-gradient(ellipse at 75% 20%, rgba(160,50,160,0.14), transparent 30%),
    radial-gradient(ellipse at 50% 50%, rgba(140,40,140,0.08), transparent 45%),
    radial-gradient(circle at 40% 30%, rgba(40,10,50,0.1), transparent 25%),
    radial-gradient(circle at 65% 70%, rgba(50,15,60,0.08), transparent 20%),
    radial-gradient(ellipse at 50% 15%, rgba(220,200,255,0.25), transparent 40%),
    radial-gradient(ellipse at 50% 50%, transparent 40%, rgba(40,10,50,0.12) 100%);
}
.unit-card.faction-seri .card-texture {
  filter: url(#noise-ethereal);
  opacity: 0.1;
  mix-blend-mode: soft-light;
}

/* Soli — gilded vellum, radiant sunburst */
.unit-card.faction-soli {
  background-color: #ebe5cc;
  background-image:
    radial-gradient(ellipse at 50% 35%, rgba(255,230,150,0.45), transparent 50%),
    linear-gradient(0deg, transparent 45%, rgba(255,240,180,0.1) 48%, rgba(255,240,180,0.15) 50%, rgba(255,240,180,0.1) 52%, transparent 55%),
    linear-gradient(60deg, transparent 45%, rgba(255,235,170,0.08) 48%, rgba(255,235,170,0.12) 50%, rgba(255,235,170,0.08) 52%, transparent 55%),
    linear-gradient(120deg, transparent 45%, rgba(255,235,170,0.08) 48%, rgba(255,235,170,0.12) 50%, rgba(255,235,170,0.08) 52%, transparent 55%),
    radial-gradient(circle at 25% 60%, rgba(255,220,130,0.2), transparent 30%),
    radial-gradient(circle at 75% 45%, rgba(255,215,120,0.15), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(255,250,235,0.3), transparent 60%),
    radial-gradient(ellipse at 30% 80%, rgba(230,220,190,0.2), transparent 35%),
    radial-gradient(ellipse at 70% 15%, rgba(240,235,215,0.15), transparent 30%);
}
.unit-card.faction-soli .card-texture {
  opacity: 0.08;
}

/* Tidehaven — sea-weathered vellum, rippled */
.unit-card.faction-tidehaven {
  background-color: #cce6e3;
  background-image:
    repeating-linear-gradient(
      175deg,
      transparent,
      transparent 14px,
      rgba(120,190,190,0.08) 14px,
      rgba(120,190,190,0.12) 18px,
      transparent 18px,
      transparent 32px
    ),
    radial-gradient(ellipse at 25% 40%, rgba(100,180,175,0.18), transparent 35%),
    radial-gradient(ellipse at 70% 75%, rgba(110,185,180,0.14), transparent 30%),
    radial-gradient(ellipse at 55% 20%, rgba(90,170,165,0.1), transparent 25%),
    radial-gradient(circle at 40% 60%, rgba(220,240,238,0.3), transparent 30%),
    radial-gradient(circle at 80% 30%, rgba(215,235,232,0.25), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(140,200,195,0.12), transparent 60%);
}
.unit-card.faction-tidehaven .card-texture {
  filter: url(#noise-ripple);
  opacity: 0.14;
  mix-blend-mode: multiply;
}

/* Stonehart — rough stone tablet, cold */
.unit-card.faction-stonehart {
  background-color: #d5d5d3;
  background-image:
    linear-gradient(35deg, transparent 48%, rgba(120,115,110,0.08) 49%, rgba(100,95,90,0.1) 50%, rgba(120,115,110,0.08) 51%, transparent 52%),
    linear-gradient(155deg, transparent 46%, rgba(110,105,100,0.06) 48%, rgba(95,90,85,0.08) 49%, transparent 51%),
    linear-gradient(80deg, transparent 44%, rgba(115,110,105,0.05) 47%, rgba(100,95,90,0.07) 48%, transparent 51%),
    radial-gradient(ellipse at 30% 25%, rgba(190,188,185,0.3), transparent 40%),
    radial-gradient(ellipse at 70% 75%, rgba(175,173,170,0.25), transparent 35%),
    radial-gradient(ellipse at 50% 50%, rgba(185,183,180,0.2), transparent 50%),
    radial-gradient(ellipse at 50% 50%, transparent 50%, rgba(140,138,135,0.1) 100%);
}
.unit-card.faction-stonehart .card-texture {
  filter: url(#noise-stone);
  opacity: 0.2;
  mix-blend-mode: multiply;
}

/* Primordial Mists — ancient silk, swirling fog */
.unit-card.faction-primordial-mists {
  background-color: #dccde8;
  background-image:
    radial-gradient(ellipse at 20% 30%, rgba(200,180,230,0.3), transparent 45%),
    radial-gradient(ellipse at 80% 60%, rgba(190,170,220,0.25), transparent 40%),
    radial-gradient(ellipse at 50% 80%, rgba(210,190,240,0.2), transparent 35%),
    radial-gradient(ellipse at 65% 15%, rgba(195,175,225,0.22), transparent 38%),
    radial-gradient(ellipse at 50% 45%, rgba(240,235,250,0.4), transparent 35%),
    radial-gradient(circle at 10% 90%, rgba(120,80,160,0.1), transparent 30%),
    radial-gradient(circle at 90% 10%, rgba(130,90,170,0.08), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(220,210,240,0.15), transparent 70%);
}
.unit-card.faction-primordial-mists .card-texture {
  filter: url(#noise-ethereal);
  opacity: 0.12;
  mix-blend-mode: soft-light;
}

/* Dusters — sandpaper, wind-swept */
.unit-card.faction-dusters {
  background-color: #e8dece;
  background-image:
    repeating-linear-gradient(
      165deg,
      transparent,
      transparent 20px,
      rgba(200,175,140,0.06) 20px,
      rgba(200,175,140,0.1) 23px,
      transparent 23px,
      transparent 43px
    ),
    radial-gradient(ellipse at 25% 20%, rgba(240,225,200,0.35), transparent 35%),
    radial-gradient(ellipse at 75% 70%, rgba(215,195,165,0.25), transparent 30%),
    radial-gradient(ellipse at 50% 45%, rgba(225,210,185,0.2), transparent 40%),
    radial-gradient(circle at 60% 15%, rgba(235,220,195,0.2), transparent 25%),
    radial-gradient(circle at 35% 80%, rgba(180,160,130,0.12), transparent 25%),
    radial-gradient(circle at 80% 40%, rgba(175,155,125,0.1), transparent 20%),
    linear-gradient(180deg, rgba(240,225,200,0.1) 0%, rgba(210,190,160,0.08) 100%);
}
.unit-card.faction-dusters .card-texture {
  filter: url(#noise-sand);
  opacity: 0.16;
  mix-blend-mode: multiply;
}

/* Down Town — modern cardstock, faintly gridded, pale green */
.unit-card.faction-down-town {
  background-color: #d6e8d8;
  background-image:
    repeating-linear-gradient(
      0deg,
      transparent,
      transparent 23px,
      rgba(140,170,145,0.06) 23px,
      rgba(140,170,145,0.06) 24px
    ),
    repeating-linear-gradient(
      90deg,
      transparent,
      transparent 23px,
      rgba(140,170,145,0.06) 23px,
      rgba(140,170,145,0.06) 24px
    ),
    radial-gradient(ellipse at 30% 30%, rgba(220,235,222,0.3), transparent 40%),
    radial-gradient(ellipse at 70% 65%, rgba(210,228,212,0.25), transparent 35%),
    radial-gradient(ellipse at 50% 50%, rgba(215,230,218,0.15), transparent 50%);
}
.unit-card.faction-down-town .card-texture {
  opacity: 0.06;
}

/* ═══════════════════════════════════════════════════════════════
   THEME: Simple Dark — art deco luxury, gold on black
   Activated by body.theme-dark
   ═══════════════════════════════════════════════════════════════ */

/* ── Card body: near-black, gold border, no parchment ──────── */
body.theme-dark .unit-card {
  background-color: #1a1a1a;
  background-image: none;
  border: 1.5px solid #c5a64e;
  border-radius: 4px;
  box-shadow:
    0 4px 20px rgba(0,0,0,0.6),
    inset 0 0 0 0.5px rgba(197,166,78,0.3);
}

/* ── Kill paper noise texture ──────────────────────────────── */
body.theme-dark .unit-card .card-texture {
  opacity: 0;
}

/* ── Art deco corner flourishes (top-left + top-right fans) ── */
body.theme-dark .unit-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  background:
    conic-gradient(
      from 180deg at 0% 0%,
      transparent 0deg, #c5a64e 1deg, transparent 3deg,
      transparent 8deg, #c5a64e 9deg, transparent 11deg,
      transparent 16deg, #c5a64e 17deg, transparent 19deg,
      transparent 24deg, #c5a64e 25deg, transparent 27deg,
      transparent 32deg, #c5a64e 33deg, transparent 35deg,
      transparent 40deg, #c5a64e 41deg, transparent 43deg,
      transparent 48deg, #c5a64e 49deg, transparent 51deg,
      transparent 56deg, #c5a64e 57deg, transparent 59deg,
      transparent 64deg, #c5a64e 65deg, transparent 67deg,
      transparent 72deg, #c5a64e 73deg, transparent 75deg,
      transparent 80deg, #c5a64e 81deg, transparent 83deg,
      transparent 88deg, #c5a64e 89deg, transparent 91deg,
      transparent 360deg
    ),
    conic-gradient(
      from 270deg at 100% 0%,
      transparent 0deg, #c5a64e 1deg, transparent 3deg,
      transparent 8deg, #c5a64e 9deg, transparent 11deg,
      transparent 16deg, #c5a64e 17deg, transparent 19deg,
      transparent 24deg, #c5a64e 25deg, transparent 27deg,
      transparent 32deg, #c5a64e 33deg, transparent 35deg,
      transparent 40deg, #c5a64e 41deg, transparent 43deg,
      transparent 48deg, #c5a64e 49deg, transparent 51deg,
      transparent 56deg, #c5a64e 57deg, transparent 59deg,
      transparent 64deg, #c5a64e 65deg, transparent 67deg,
      transparent 72deg, #c5a64e 73deg, transparent 75deg,
      transparent 80deg, #c5a64e 81deg, transparent 83deg,
      transparent 88deg, #c5a64e 89deg, transparent 91deg,
      transparent 360deg
    );
  -webkit-mask-image:
    radial-gradient(circle at 0% 0%, black 0%, transparent 22%),
    radial-gradient(circle at 100% 0%, black 0%, transparent 22%);
  -webkit-mask-composite: source-over;
  mask-image:
    radial-gradient(circle at 0% 0%, black 0%, transparent 22%),
    radial-gradient(circle at 100% 0%, black 0%, transparent 22%);
  mask-composite: add;
}

/* ── Notched frame → straight gold border ──────────────────── */
body.theme-dark .card-notched::after {
  clip-path: none;
  border: 1px solid #c5a64e;
  border-radius: 2px;
  box-shadow: none;
}

/* ── Remove corner triangle SVGs ───────────────────────────── */
body.theme-dark .card-notched::before {
  background: none;
}

/* ── Title bar: light name area ────────────────────────────── */
body.theme-dark .unit-card .card-header {
  background: #f0ede6;
  border-bottom: 1px solid #c5a64e;
}

body.theme-dark .unit-card .card-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-dark .unit-card .card-cost {
  background: #1a1a1a;
  border: 1px solid #c5a64e;
  color: #c5a64e;
  box-shadow: none;
}

/* ── Art area: white background ────────────────────────────── */
body.theme-dark .unit-card .card-image {
  background: #f5f3ef;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
}

/* ── Stats bar: dark band with gold accents ────────────────── */
body.theme-dark .unit-card .card-stats {
  background: #1a1a1a;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
  padding: 1px 0;
}

body.theme-dark .stat-icon path,
body.theme-dark .stat-icon polygon,
body.theme-dark .stat-icon circle,
body.theme-dark .stat-icon line {
  stroke: rgba(197,166,78,0.8) !important;
}

body.theme-dark .stat-num {
  fill: #f0ede6;
  stroke: rgba(26,26,26,0.9);
}

/* ── Rules area: light grey ────────────────────────────────── */
body.theme-dark .unit-card .card-rules {
  background: #e8e6e0;
  border-top: 1px solid #c5a64e;
  color: #1a1a1a;
}

body.theme-dark .unit-card .rule-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-dark .unit-card .rule-desc {
  color: #333;
}

/* ── Bottom diamond accent ─────────────────────────────────── */
body.theme-dark .unit-card::after {
  content: '';
  position: absolute;
  bottom: 6px;
  left: 50%;
  width: 10px;
  height: 10px;
  background: #c5a64e;
  transform: translateX(-50%) rotate(45deg);
  z-index: 3;
  border: 0.5px solid rgba(255,255,255,0.2);
}

/* ── Suppress faction backgrounds in dark theme ────────────── */
body.theme-dark .unit-card[class*="faction-"] {
  background-color: #1a1a1a;
  background-image: none;
}

body.theme-dark .unit-card[class*="faction-"] .card-texture {
  opacity: 0;
}

/* ═══════════════════════════════════════════════════════════════
   THEME: Gem CSS — CSS-recreated gemBG style
   Activated by body.theme-gem
   ═══════════════════════════════════════════════════════════════ */

body.theme-gem .unit-card {
  background-color: #1a1a1a;
  background-image: none;
  border: 1.5px solid #c5a64e;
  border-radius: 4px;
  box-shadow:
    0 4px 20px rgba(0,0,0,0.6),
    inset 0 0 0 0.5px rgba(197,166,78,0.3);
}

body.theme-gem .unit-card .card-texture { opacity: 0; }

/* Gold L-brackets at all 4 corners */
body.theme-gem .unit-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  background:
    linear-gradient(90deg, #c5a64e 18px, transparent 18px) no-repeat 3px 3px / 20px 1.5px,
    linear-gradient(180deg, #c5a64e 18px, transparent 18px) no-repeat 3px 3px / 1.5px 20px,
    linear-gradient(270deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) 3px / 20px 1.5px,
    linear-gradient(180deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) 3px / 1.5px 20px,
    linear-gradient(270deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) calc(100% - 3px) / 20px 1.5px,
    linear-gradient(0deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) calc(100% - 3px) / 1.5px 20px,
    linear-gradient(90deg, #c5a64e 18px, transparent 18px) no-repeat 3px calc(100% - 3px) / 20px 1.5px,
    linear-gradient(0deg, #c5a64e 18px, transparent 18px) no-repeat 3px calc(100% - 3px) / 1.5px 20px;
}

body.theme-gem .card-notched::after {
  clip-path: none;
  border: 1px solid #c5a64e;
  border-radius: 2px;
  box-shadow: none;
}

body.theme-gem .card-notched::before {
  background: none;
}

body.theme-gem .unit-card .card-header {
  background: #f0ede6;
  border-bottom: 1px solid #c5a64e;
}

body.theme-gem .unit-card .card-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-gem .unit-card .card-cost {
  background: #1a1a1a;
  border: 1px solid #c5a64e;
  color: #c5a64e;
  box-shadow: none;
}

body.theme-gem .unit-card .card-image {
  background: #f5f3ef;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
}

body.theme-gem .unit-card .card-stats {
  background: #1a1a1a;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
  padding: 1px 0;
}

body.theme-gem .stat-icon path,
body.theme-gem .stat-icon polygon,
body.theme-gem .stat-icon circle,
body.theme-gem .stat-icon line {
  stroke: rgba(197,166,78,0.8) !important;
}

body.theme-gem .stat-num {
  fill: #f0ede6;
  stroke: rgba(26,26,26,0.9);
}

body.theme-gem .unit-card .card-rules {
  background: #e4e8ea;
  border-top: 1px solid #c5a64e;
  color: #1a1a1a;
}

body.theme-gem .unit-card .rule-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-gem .unit-card .rule-desc {
  color: #333;
}

/* Bottom diamond accent */
body.theme-gem .unit-card::after {
  content: '';
  position: absolute;
  bottom: 6px;
  left: 50%;
  width: 10px;
  height: 10px;
  background: #c5a64e;
  transform: translateX(-50%) rotate(45deg);
  z-index: 3;
  border: 0.5px solid rgba(255,255,255,0.2);
}

body.theme-gem .unit-card[class*="faction-"] {
  background-color: #1a1a1a;
  background-image: none;
}

body.theme-gem .unit-card[class*="faction-"] .card-texture {
  opacity: 0;
}

/* ═══════════════════════════════════════════════════════════════
   THEME: Gem Image — actual gemBG.png as background
   Activated by body.theme-gem-img
   ═══════════════════════════════════════════════════════════════ */

body.theme-gem-img .unit-card {
  background: url('../nandeck/images/gemBG.png') center / cover no-repeat;
  border: none;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

body.theme-gem-img .unit-card .card-texture { opacity: 0; }

body.theme-gem-img .unit-card::before,
body.theme-gem-img .unit-card::after { display: none; }

body.theme-gem-img .card-notched::after { display: none; }
body.theme-gem-img .card-notched::before { display: none; }

body.theme-gem-img .unit-card .card-header {
  background: transparent;
}

body.theme-gem-img .unit-card .card-name {
  color: #f0ede6;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}

body.theme-gem-img .unit-card .card-cost {
  background: transparent;
  border: none;
  color: #000000;
  box-shadow: none;
}

body.theme-gem-img .unit-card .card-image {
  background: transparent;
}

body.theme-gem-img .unit-card .card-image img {
  object-fit: cover;
}

body.theme-gem-img .unit-card .card-stats {
  background: transparent;
  margin-top: -3px;
}

body.theme-gem-img .stat-icon path,
body.theme-gem-img .stat-icon polygon,
body.theme-gem-img .stat-icon circle,
body.theme-gem-img .stat-icon line {
  stroke: rgba(197,166,78,0.8) !important;
}

body.theme-gem-img .stat-num {
  fill: #f0ede6;
  stroke: rgba(26,26,26,0.9);
}

body.theme-gem-img .unit-card .card-rules {
  background: transparent;
  color: #1a1a1a;
}

body.theme-gem-img .unit-card .rule-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-gem-img .unit-card .rule-desc {
  color: #333;
}

body.theme-gem-img .unit-card[class*="faction-"] {
  background: url('../nandeck/images/gemBG.png') center / cover no-repeat;
}

body.theme-gem-img .unit-card[class*="faction-"] .card-texture {
  opacity: 0;
}

/* ── Scoreboard ──────────────────────────────────────────────── */

.scoreboard {
  margin-top: 12px;
  padding-top: 8px;
  border-top: 1px solid rgba(255,255,255,0.1);
  font-size: 14px;
  font-weight: 600;
}
