/* styles.css — Tirs of Traea */

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #2C2725;
  color: #e0e0e0;
  font-family: 'Segoe UI', system-ui, sans-serif;
  overflow: hidden;
}

canvas {
  display: block;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 0;
}

#overlayCanvas {
  z-index: 2;
  pointer-events: none;
}

/* ── Unit tokens (HTML overlay on canvas) ────────────────────── */

#unit-tokens {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}

.unit-token {
  position: absolute;
  border-radius: 50%;
  overflow: hidden;
  transform: translate(-50%, -50%);
  border: 3px solid #fff;
  background: #333;
  pointer-events: auto;
  cursor: pointer;
}

.unit-token.player-1 { background: #2A9D8F; border-color: #2A9D8F; }
.unit-token.player-2 { background: #D4872C; border-color: #D4872C; }
.unit-token.activated { border-color: #555; opacity: 0.65; }
.unit-token.selected { border-color: #FFD700; border-width: 3px; box-shadow: 0 0 8px rgba(255,215,0,0.6); }

.unit-token img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center 30%;
  display: block;
}

.unit-token .token-fallback {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
}

.token-hp {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.75);
  font-weight: 700;
  text-align: center;
  border-radius: 6px;
  padding: 0 3px;
  z-index: 2;
  white-space: nowrap;
  line-height: 1.3;
}
.player-1 > .token-hp { color: #3CC4B4; }
.player-2 > .token-hp { color: #E8A24C; }

/* ── Top nav ─────────────────────────────────────────────────── */

#top-nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 40px;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  padding: 0 16px;
  z-index: 200;
}

.nav-title {
  font-size: 15px;
  font-weight: 700;
  color: #ffd700;
  letter-spacing: 0.5px;
}

/* ── Theme toggle buttons ───────────────────────────────────── */

.theme-menu {
  margin-left: auto;
}

.theme-menu .debug-dropdown {
  width: auto;
  min-width: 120px;
  flex-direction: column;
}

/* ── Debug condition menu ────────────────────────────────────── */

.debug-menu {
  position: relative;
  margin-left: 8px;
}

.btn-debug-toggle {
  padding: 4px 10px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 3px;
  background: transparent;
  color: rgba(255,255,255,0.5);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.15s;
}

.btn-debug-toggle:hover {
  color: rgba(255,255,255,0.8);
  border-color: rgba(255,255,255,0.3);
}

.debug-dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 4px;
  background: rgba(10, 10, 20, 0.95);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 6px;
  padding: 4px;
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  width: 240px;
  z-index: 200;
  backdrop-filter: blur(8px);
}

.debug-dropdown.hidden { display: none; }

.btn-debug-cond {
  padding: 4px 8px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 3px;
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.7);
  font-size: 10px;
  cursor: pointer;
  text-transform: capitalize;
  transition: all 0.15s;
}

.btn-debug-cond:hover {
  background: rgba(255,255,255,0.15);
  color: #fff;
}

.btn-debug-clear {
  width: 100%;
  color: #f66;
  border-color: rgba(255,100,100,0.3);
}

.debug-sep {
  width: 100%;
  border: none;
  border-top: 1px solid rgba(255,255,255,0.1);
  margin: 2px 0;
}

/* ── Battle HUD (top-center during battle) ───────────────────── */

#battle-hud {
  position: fixed;
  top: 44px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: stretch;
  gap: 0;
  z-index: 150;
  background: rgba(10, 10, 20, 0.92);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 8px;
  backdrop-filter: blur(8px);
  overflow: hidden;
  min-width: 400px;
}

.hud-score {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 8px 18px;
  min-width: 80px;
}

#hud-p1 { background: rgba(42, 157, 143, 0.25); }
#hud-p2 { background: rgba(212, 135, 44, 0.25); }

.hud-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  opacity: 0.7;
}

#hud-p1 .hud-label { color: #2A9D8F; }
#hud-p2 .hud-label { color: #D4872C; }

.hud-pts {
  font-size: 22px;
  font-weight: 800;
  color: #fff;
  line-height: 1;
}

#hud-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 6px 20px;
  gap: 2px;
  flex: 1;
}

#hud-round {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: rgba(255,255,255,0.5);
}

#hud-turn {
  font-size: 14px;
  font-weight: 700;
  transition: color 0.2s;
}

#hud-turn.turn-p1 { color: #2A9D8F; }
#hud-turn.turn-p2 { color: #D4872C; }

.btn-hud-end {
  margin-top: 2px;
  padding: 3px 14px;
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  background: rgba(255,255,255,0.08);
  color: #e0e0e0;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s, border-color 0.15s;
}

.btn-hud-end:hover {
  background: rgba(200,100,100,0.25);
  border-color: rgba(255,255,255,0.4);
}

/* ── Status bar (turn / phase indicator near board) ──────────── */

#status-bar {
  position: fixed;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  padding: 6px 20px;
  border-radius: 20px;
  background: rgba(0,0,0,0.75);
  color: #ffd700;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  z-index: 100;
  pointer-events: none;
}

/* ── Panels ──────────────────────────────────────────────────── */

.phase-panel {
  position: fixed;
  z-index: 50;
  background: rgba(20, 20, 40, 0.92);
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(8px);
  padding: 16px;
  overflow-y: auto;
}

.side-panel {
  top: 48px;
  width: 180px;
  max-height: calc(100vh - 60px);
  border-radius: 8px;
}

.side-panel.side-left,
.side-panel:not(.side-right) {
  left: 8px;
}

.side-panel.side-right {
  left: auto;
  right: 8px;
}

.roster-points-bar {
  position: sticky;
  top: -16px;
  margin: -16px -16px 12px;
  padding: 8px 12px;
  text-align: center;
  background: rgba(20, 20, 40, 0.95);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  z-index: 1;
}

/* Player-colored panels */
.phase-panel.player-1,
#panel-faction-p1 {
  background: rgba(42, 157, 143, 0.2);
  border-color: rgba(42, 157, 143, 0.4);
}

.phase-panel.player-2,
#panel-faction-p2 {
  background: rgba(212, 135, 44, 0.2);
  border-color: rgba(212, 135, 44, 0.4);
}

.center-panel {
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  border-radius: 12px;
  text-align: center;
}

/* ── Round phase panel ────────────────────────────────────────── */

#panel-round { width: 320px; }

.step-done {
  color: #6a6;
  font-size: 12px;
  padding: 3px 0;
}
.step-done::before { content: '\2713 '; }

.step-current {
  background: rgba(255,255,255,0.06);
  border-radius: 6px;
  padding: 10px;
  margin: 6px 0;
}

.step-pending {
  color: #666;
  font-size: 12px;
  padding: 3px 0;
}

/* ── Crystal scoring animation ─────────────────────────────── */

.crystal-anim img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.score-pop {
  animation: scorePop 0.35s ease-out;
}

@keyframes scorePop {
  0%  { transform: scale(1); }
  40% { transform: scale(1.5); }
  100% { transform: scale(1); }
}

.score-float {
  position: fixed;
  font-weight: 800;
  font-size: 16px;
  pointer-events: none;
  z-index: 1001;
  transform: translateX(-50%);
  animation: scoreFloat 0.85s ease-out forwards;
}

.score-float-p1 {
  color: #2A9D8F;
  text-shadow: 0 0 6px rgba(42,157,143,0.6), 0 1px 3px rgba(0,0,0,0.8);
}

.score-float-p2 {
  color: #D4872C;
  text-shadow: 0 0 6px rgba(212,135,44,0.6), 0 1px 3px rgba(0,0,0,0.8);
}

@keyframes scoreFloat {
  0%   { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(-28px); }
}

/* ── Condition indicators ────────────────────────────────────── */

.token-conditions {
  position: absolute;
  top: -4px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 2px;
  z-index: 2;
}

.cond-icon {
  width: 18px;
  height: 18px;
  border-radius: 3px;
  border: 1px solid rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  line-height: 1;
  color: #fff;
  text-shadow: 0 0 2px rgba(0,0,0,0.8);
}

/* Stack count badge on condition icons */
.cond-stack {
  position: absolute;
  bottom: -4px;
  right: -4px;
  min-width: 12px;
  height: 12px;
  border-radius: 6px;
  background: #222;
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  font-size: 9px;
  font-weight: 700;
  line-height: 12px;
  text-align: center;
  text-shadow: none;
  padding: 0 2px;
}

.cond-icon { position: relative; }

.cond-strengthened { background: #ff6600; }
.cond-weakness     { background: #8844aa; }
.cond-vulnerable   { background: #cc0000; }
.cond-protected    { background: #0088ff; }
.cond-poisoned     { background: #00cc00; }
.cond-burning      { background: #ff4400; }
.cond-immobilized  { background: #888888; }
.cond-dizzy        { background: #ffdd00; }
.cond-silenced     { background: #dddddd; }
.cond-disarmed     { background: #996633; }
.cond-taunted      { background: #ff00ff; }

.cond-list {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  margin: 4px 0;
}

.cond-tag {
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 10px;
  font-weight: 600;
  text-transform: capitalize;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
}

.cond-warning {
  color: #ffdd44;
  font-size: 11px;
  font-style: italic;
  margin: 2px 0;
}

.btn-quench {
  background: rgba(255,68,0,0.15);
  border-color: rgba(255,68,0,0.4);
}

.btn-ability {
  background: rgba(80, 40, 120, 0.7);
  border: 1px solid rgba(180, 120, 255, 0.5);
  color: #e8d8ff;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 11px;
  cursor: pointer;
  margin-top: 3px;
}
.btn-ability:hover { background: rgba(120, 60, 180, 0.8); }

/* ── Rules panel ──────────────────────────────────────────────── */

#panel-rules {
  width: 280px;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  top: 48px;
  transform: translateX(-50%);
}

#panel-rules h2 {
  font-size: 15px;
  margin-bottom: 10px;
}

.rules-form {
  display: flex;
  flex-direction: column;
  gap: 2px;
  text-align: left;
}

.rule-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.rule-label {
  font-size: 11px;
  color: #ccc;
  flex: 1;
}

.rule-input {
  width: 50px;
  padding: 3px 4px;
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  background: rgba(255,255,255,0.08);
  color: #e0e0e0;
  font-size: 12px;
  text-align: center;
}

.rule-input:focus {
  outline: none;
  border-color: #ffd700;
}

.rule-checkbox {
  width: 15px;
  height: 15px;
  accent-color: #ffd700;
  cursor: pointer;
}

/* ── Roster card areas ───────────────────────────────────────── */

.roster-area {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 40;
  pointer-events: none;
}

.unit-card.roster-card {
  position: absolute;
  /* Same 240×336 base, scaled down to 160×224 (factor 0.667) */
  width: 240px;
  height: 336px;
  pointer-events: auto;
  cursor: grab;
  opacity: 0.92;
  transition: opacity 0.15s, box-shadow 0.15s, transform 0.3s ease;
  transform-origin: center center;
  z-index: auto;
}

.unit-card.roster-card:active {
  cursor: grabbing;
}

.unit-card.roster-card:hover {
  opacity: 1;
  box-shadow:
    0 4px 24px rgba(0,0,0,0.5),
    0 0 8px rgba(255,255,255,0.15),
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 -1px 0 rgba(0,0,0,0.08);
}

/* ── Dead unit card back ──────────────────────────────────────── */

.unit-card.card-dead {
  background: none;
  background-image: none;
  padding: 0;
  gap: 0;
  border: none;
  box-shadow: 0 4px 20px rgba(0,0,0,0.45);
}

.unit-card.card-dead .card-texture { display: none; }
.unit-card.card-dead::before,
.unit-card.card-dead::after { display: none; }

.card-back-name {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  text-align: center;
  font-size: 13px;
  font-weight: 700;
  color: rgba(255,255,255,0.75);
  background: rgba(0,0,0,0.6);
  padding: 4px 6px;
  z-index: 2;
  text-shadow: 0 1px 3px rgba(0,0,0,0.9);
}

.card-back-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 3px;
}

/* ── Lobby overlay (online/local mode select) ───────────────── */

#lobby-overlay {
  position: fixed; inset: 0;
  background: rgba(0, 0, 0, 0.88);
  display: flex; align-items: center; justify-content: center;
  z-index: 9999;
}
#lobby-overlay.hidden { display: none; }

.lobby-panel {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  border: 2px solid #555;
  border-radius: 16px;
  padding: 36px 40px;
  text-align: center;
  color: #eee;
  min-width: 340px;
  max-width: 420px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.6);
}
.lobby-panel h2 {
  margin: 0 0 24px;
  font-size: 22px;
  color: #ffd700;
  letter-spacing: 1px;
}

.lobby-section {
  margin: 12px 0;
}

.btn-lobby {
  padding: 10px 24px;
  font-size: 14px;
  border-radius: 8px;
  cursor: pointer;
  border: 1px solid #555;
  background: #2a2a4a;
  color: #eee;
  transition: background 0.15s;
}
.btn-lobby:hover:not(:disabled) {
  background: #3a3a6a;
}
.btn-lobby:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.btn-local-play {
  background: #2e6b3e;
  border-color: #4a8;
  font-size: 16px;
  padding: 12px 32px;
}
.btn-local-play:hover {
  background: #3a8050;
}

.lobby-divider {
  display: flex; align-items: center;
  margin: 20px 0;
  color: #888;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.lobby-divider::before,
.lobby-divider::after {
  content: '';
  flex: 1;
  border-bottom: 1px solid #444;
}
.lobby-divider span {
  padding: 0 12px;
}

.lobby-input {
  padding: 8px 12px;
  margin: 8px 0;
  width: 200px;
  border: 1px solid #555;
  border-radius: 6px;
  background: #111;
  color: #eee;
  font-size: 16px;
  font-family: monospace;
  text-align: center;
  letter-spacing: 2px;
  text-transform: uppercase;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.room-code-label {
  font-size: 11px;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin: 12px 0 4px;
}
.room-code {
  font-size: 28px;
  font-weight: 700;
  font-family: monospace;
  color: #ffd700;
  letter-spacing: 3px;
  margin: 4px 0 8px;
  user-select: all;
}

.lobby-status {
  font-size: 13px;
  color: #aaa;
  margin: 8px 0 0;
}

/* ── Combat log ──────────────────────────────────────────────── */

.combat-log {
  position: fixed;
  bottom: 0;
  right: 8px;
  width: 320px;
  z-index: 200;
  background: rgba(15, 15, 20, 0.92);
  border: 1px solid rgba(255,255,255,0.12);
  border-bottom: none;
  border-radius: 8px 8px 0 0;
  font-size: 12px;
  font-family: 'Consolas', 'Monaco', monospace;
  display: flex;
  flex-direction: column;
  transition: height 0.2s ease;
}

.combat-log-header {
  padding: 6px 12px;
  background: rgba(255,255,255,0.06);
  color: #aaa;
  font-weight: 700;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
  border-radius: 8px 8px 0 0;
}
.combat-log-header:hover { background: rgba(255,255,255,0.1); }

#combat-log-toggle {
  font-size: 10px;
  transition: transform 0.2s;
}

.combat-log.collapsed #combat-log-toggle { transform: rotate(180deg); }

.combat-log-body {
  max-height: 260px;
  overflow-y: auto;
  padding: 4px 0;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.15) transparent;
}

.combat-log.collapsed .combat-log-body { display: none; }

.log-entry {
  padding: 2px 10px;
  color: #ccc;
  line-height: 1.4;
  border-left: 3px solid transparent;
}
.log-entry:hover { background: rgba(255,255,255,0.04); }
.log-entry.log-p1 { border-left-color: #2A9D8F; }
.log-entry.log-p2 { border-left-color: #D4872C; }
.log-entry.log-system { color: #888; font-style: italic; border-left-color: #555; }

.hidden { display: none !important; }

/* ── Typography ──────────────────────────────────────────────── */

h2 {
  font-size: 18px;
  margin-bottom: 12px;
  color: #ededed;
  border-bottom: 1px solid rgba(255,215,0,0.3);
  padding-bottom: 6px;
}

h3 {
  font-size: 14px;
  margin: 10px 0 6px;
  color: #ccc;
}

p { font-size: 13px; margin: 4px 0; }

.hint { color: #999; font-style: italic; font-size: 12px; }

/* ── Buttons ─────────────────────────────────────────────────── */

.btn {
  display: inline-block;
  padding: 6px 12px;
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  background: rgba(255,255,255,0.08);
  color: #e0e0e0;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.15s, border-color 0.15s;
  text-align: left;
}

.btn:hover:not(:disabled) {
  background: rgba(255,255,255,0.18);
  border-color: rgba(255,255,255,0.4);
}

.btn:disabled {
  opacity: 0.35;
  cursor: default;
}

.btn.selected, .btn.in-roster {
  border-color: #ffd700;
  background: rgba(255,215,0,0.15);
}

/* ── Faction buttons ─────────────────────────────────────────── */

.faction-pick { margin-bottom: 12px; }

.faction-grid {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.btn-faction {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  font-size: 12px;
}

.faction-logo {
  width: 30px;
  height: 30px;
  object-fit: cover;
  flex-shrink: 0;
  border-radius: 50%;
}

/* ── Unit list buttons ───────────────────────────────────────── */

.unit-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  margin-bottom: 10px;
}

.btn-unit {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 8px 10px;
  gap: 8px;
}

.unit-thumb {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  background: #333;
  display: flex;
  align-items: center;
  justify-content: center;
}
.unit-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center 30%;
}
.unit-thumb .thumb-fallback {
  color: #fff;
  font-size: 12px;
  font-weight: 700;
}

.unit-name { font-weight: 600; flex: 1; }

.unit-stats {
  font-size: 11px;
  color: #aaa;
  white-space: nowrap;
}

.unit-cost { font-size: 11px; color: #ffd700; }

.remove-x { color: #f66; font-size: 12px; }

/* ── Surface buttons ─────────────────────────────────────────── */

.surface-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.btn-surface {
  flex: 0 0 auto;
  padding: 0;
  background: none;
  border: 2px solid transparent;
  border-radius: 4px;
  cursor: pointer;
  line-height: 0;
}

.surface-icon {
  width: 28px;
  height: 28px;
  object-fit: contain;
}

.btn-surface:hover {
  border-color: #ffd700;
}

/* ── Battle UI ───────────────────────────────────────────────── */

.activation-info {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
  padding: 10px;
  margin: 8px 0;
}

.activation-info p { margin-bottom: 8px; }

.btn-action {
  margin: 2px 4px 2px 0;
  padding: 6px 14px;
}

.btn-action:hover:not(:disabled) {
  background: rgba(100,200,100,0.25);
}

.btn-skip:hover:not(:disabled) {
  background: rgba(200,200,100,0.25);
}

.btn-end:hover:not(:disabled) {
  background: rgba(200,100,100,0.25);
}

.done-label {
  display: inline-block;
  padding: 6px 14px;
  font-size: 12px;
  color: #666;
}

.btn-confirm {
  display: block;
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  background: rgba(255,215,0,0.15);
  border-color: #ffd700;
  color: #ffd700;
  font-weight: 600;
  text-align: center;
}

.btn-confirm:hover {
  background: rgba(255,215,0,0.3);
}

.btn-back {
  display: block;
  width: 100%;
  padding: 6px;
  margin-top: 4px;
  background: transparent;
  border-color: rgba(255,255,255,0.2);
  color: rgba(255,255,255,0.6);
  font-size: 11px;
}

.btn-back:hover {
  background: rgba(255,255,255,0.08);
  color: #fff;
}

/* ── Unit card (bg3-inspired parchment style) ────────────────── */

.unit-card {
  position: fixed;
  z-index: 300;
  width: 240px;
  height: 336px;
  border-radius: 3px;
  /* Near-white parchment with warm mottling */
  background-color: #ebe8e2;
  background-image:
    radial-gradient(ellipse at 25% 15%, rgba(250,249,246,0.7), transparent 45%),
    radial-gradient(ellipse at 75% 85%, rgba(210,205,195,0.45), transparent 45%),
    radial-gradient(ellipse at 50% 50%, rgba(230,226,218,0.35), transparent 70%),
    radial-gradient(circle at 15% 70%, rgba(200,195,185,0.3), transparent 30%),
    radial-gradient(circle at 85% 25%, rgba(242,240,236,0.4), transparent 30%),
    radial-gradient(circle at 40% 90%, rgba(195,190,178,0.25), transparent 25%),
    radial-gradient(circle at 70% 10%, rgba(205,200,190,0.2), transparent 20%),
    radial-gradient(ellipse at 10% 40%, rgba(215,210,200,0.2), transparent 35%),
    radial-gradient(ellipse at 90% 60%, rgba(198,193,182,0.2), transparent 35%);
  box-shadow:
    0 4px 20px rgba(0,0,0,0.45),
    inset 0 1px 0 rgba(255,255,255,0.5),
    inset 0 -1px 0 rgba(0,0,0,0.06);
  pointer-events: none;
  font-size: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 6px 8px 5px;
  gap: 3px;
}

/* Paper noise texture overlay */
.unit-card .card-texture {
  position: absolute;
  inset: 0;
  opacity: 0.12;
  filter: url(#paper-noise);
  pointer-events: none;
  z-index: 0;
}
/* Ensure card children sit above texture */
.unit-card > *:not(.card-texture) {
  position: relative;
  z-index: 1;
}

/* ── Notched frame with bevels ── */
.card-notched {
  position: relative;
}

/* Notched border + bevel */
.card-notched::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: 1px solid rgba(40,35,28,0.25);
  box-shadow:
    inset 1px 1px 0 rgba(255,255,255,0.3),
    inset -1px -1px 0 rgba(0,0,0,0.08),
    inset 2px 2px 3px rgba(255,255,255,0.05),
    inset -2px -2px 3px rgba(0,0,0,0.04);
  clip-path: polygon(
    4px 0, calc(100% - 4px) 0,
    calc(100% - 4px) 4px, 100% 4px,
    100% calc(100% - 4px), calc(100% - 4px) calc(100% - 4px),
    calc(100% - 4px) 100%, 4px 100%,
    4px calc(100% - 4px), 0 calc(100% - 4px),
    0 4px, 4px 4px
  );
}

/* Small corner triangle outlines at each notch */
.card-notched::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  /* 5×5 SVG triangle outlines. #28231c40 ≈ rgba(40,35,28,0.25) */
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 5 L5 0 L0 0 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 0 0,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 0 L5 0 L5 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 100% 0,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M5 0 L5 5 L0 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 100% 100%,
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='5' height='5'%3E%3Cpath d='M0 0 L5 5 L0 5 Z' fill='none' stroke='%2328231c40' stroke-width='0.75'/%3E%3C/svg%3E") no-repeat 0 100%;
}

/* ── Title bar ── */
.unit-card .card-header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px 24px;
  background:
    linear-gradient(180deg, rgba(255,255,255,0.12) 0%, transparent 40%, rgba(0,0,0,0.04) 100%);
}

.unit-card .card-name {
  font-weight: 700;
  font-size: 11px;
  color: #28231c;
  text-align: center;
  text-shadow: 0 1px 0 rgba(255,255,255,0.25);
}

.unit-card .card-cost {
  position: absolute;
  left: 2px;
  top: 60%;
  transform: translateY(-50%);
  background:
    radial-gradient(circle, rgba(255,255,255,0.15), rgba(0,0,0,0.04));
  border: 1px solid rgba(40,35,28,0.4);
  border-radius: 50%;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 10px;
  color: #28231c;
  flex-shrink: 0;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.25),
    inset 0 -1px 0 rgba(0,0,0,0.08);
}

/* ── Art area ── */
.unit-card .card-image {
  width: 100%;
  flex: 1 1 0;
  min-height: 0;
  background: #1a1610;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-top:-5%;
}
/* Image needs to stay within bounds but not clip the frame pseudos */
.unit-card .card-image img,
.unit-card .card-image .no-image {
  position: relative;
  z-index: 0;
}

.unit-card .card-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.unit-card .card-image .no-image {
  color: #666;
  font-size: 36px;
  font-weight: 700;
}

.unit-card .card-type {
  padding: 4px 10px;
  font-size: 11px;
  color: #5a5040;
  font-style: italic;
}

/* ── Stats row ── */
.unit-card .card-stats {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  padding: 0;
}

.stat-icon {
  width: 22px;
  height: 22px;
  flex-shrink: 0;
}

.stat-num {
  fill: #28231c;
  font-size: 16px;
  font-weight: 700;
  font-family: inherit;
  text-anchor: middle;
  dominant-baseline: central;
  paint-order: stroke fill;
  stroke: rgba(237,234,228,0.9);
  stroke-width: 1.5px;
}

/* ── Rules text box ── */
/* ── Conditions bar on non-enlarged cards ─────────────────────── */
.card-conditions-bar {
  display: flex;
  justify-content: center;
  gap: 3px;
  padding: 1px 4px;
  min-height: 0;
  z-index: 3;
}
.card-conditions-bar:empty { display: none; }

.card-conditions-bar .cond-icon {
  width: 16px;
  height: 16px;
  font-size: 10px;
  border-radius: 3px;
}

.card-conditions-bar .cond-stack {
  min-width: 10px;
  height: 10px;
  font-size: 7px;
  line-height: 10px;
  bottom: -3px;
  right: -3px;
}

.unit-card .card-rules {
  padding: 4px 7px;
  font-size: 9px;
  line-height: 1.3;
  color: #2a2218;
  flex: 1 1 0;
  min-height: 0;
  overflow-y: auto;
  background: rgba(0,0,0,0.02);
}

.unit-card .card-rule {
  margin-bottom: 3px;
}
.unit-card .card-rule:last-child {
  margin-bottom: 0;
}

.unit-card .rule-name {
  text-align: center;
  font-weight: 700;
  font-size: 9px;
  color: #28231c;
  text-shadow: 0 1px 0 rgba(255,255,255,0.2);
}

.unit-card .rule-desc {
  font-size: 7.5px;
  color: #000;
  line-height: 1.25;
  text-align: center;
}

.unit-card .card-footer {
  padding: 4px 10px 6px;
  font-size: 10px;
  color: #776a4e;
  text-align: right;
  border-top: 1px solid rgba(40,35,28,0.15);
  font-style: italic;
}

/* ── Faction card textures ─────────────────────────────────── */

/* Syli — bark paper, dappled canopy light */
.unit-card.faction-syli {
  background-color: #d4e8d8;
  background-image:
    radial-gradient(ellipse at 20% 20%, rgba(255,255,230,0.5), transparent 30%),
    radial-gradient(ellipse at 60% 15%, rgba(255,255,220,0.35), transparent 25%),
    radial-gradient(ellipse at 80% 45%, rgba(255,255,230,0.3), transparent 20%),
    radial-gradient(ellipse at 35% 70%, rgba(255,255,220,0.4), transparent 28%),
    radial-gradient(ellipse at 75% 80%, rgba(255,255,230,0.25), transparent 22%),
    radial-gradient(ellipse at 45% 40%, rgba(80,110,70,0.15), transparent 35%),
    radial-gradient(ellipse at 15% 55%, rgba(70,100,60,0.12), transparent 30%),
    radial-gradient(ellipse at 70% 65%, rgba(85,115,75,0.1), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(160,180,140,0.2), transparent 70%);
}
.unit-card.faction-syli .card-texture {
  filter: url(#noise-organic);
  opacity: 0.15;
  mix-blend-mode: multiply;
}

/* Red Ridge — volcanic ash, ember glow */
.unit-card.faction-red-ridge {
  background-color: #ebd5cc;
  background-image:
    radial-gradient(circle at 30% 75%, rgba(255,120,50,0.2), transparent 25%),
    radial-gradient(circle at 70% 25%, rgba(255,100,40,0.15), transparent 20%),
    radial-gradient(circle at 50% 50%, rgba(255,140,60,0.1), transparent 30%),
    radial-gradient(ellipse at 20% 30%, rgba(80,30,20,0.12), transparent 35%),
    radial-gradient(ellipse at 80% 70%, rgba(90,35,25,0.1), transparent 30%),
    radial-gradient(ellipse at 55% 85%, rgba(70,25,15,0.08), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(200,120,80,0.15), transparent 65%),
    linear-gradient(180deg, rgba(255,180,100,0.08) 0%, transparent 40%),
    linear-gradient(0deg, rgba(100,30,20,0.06) 0%, transparent 30%);
}
.unit-card.faction-red-ridge .card-texture {
  filter: url(#noise-volcanic);
  opacity: 0.18;
  mix-blend-mode: multiply;
}

/* Seri — dark otherworldly silk, eerie netherrealm */
.unit-card.faction-seri {
  background-color: #e0cce0;
  background-image:
    radial-gradient(ellipse at 25% 80%, rgba(180,60,180,0.18), transparent 35%),
    radial-gradient(ellipse at 75% 20%, rgba(160,50,160,0.14), transparent 30%),
    radial-gradient(ellipse at 50% 50%, rgba(140,40,140,0.08), transparent 45%),
    radial-gradient(circle at 40% 30%, rgba(40,10,50,0.1), transparent 25%),
    radial-gradient(circle at 65% 70%, rgba(50,15,60,0.08), transparent 20%),
    radial-gradient(ellipse at 50% 15%, rgba(220,200,255,0.25), transparent 40%),
    radial-gradient(ellipse at 50% 50%, transparent 40%, rgba(40,10,50,0.12) 100%);
}
.unit-card.faction-seri .card-texture {
  filter: url(#noise-ethereal);
  opacity: 0.1;
  mix-blend-mode: soft-light;
}

/* Soli — gilded vellum, radiant sunburst */
.unit-card.faction-soli {
  background-color: #ebe5cc;
  background-image:
    radial-gradient(ellipse at 50% 35%, rgba(255,230,150,0.45), transparent 50%),
    linear-gradient(0deg, transparent 45%, rgba(255,240,180,0.1) 48%, rgba(255,240,180,0.15) 50%, rgba(255,240,180,0.1) 52%, transparent 55%),
    linear-gradient(60deg, transparent 45%, rgba(255,235,170,0.08) 48%, rgba(255,235,170,0.12) 50%, rgba(255,235,170,0.08) 52%, transparent 55%),
    linear-gradient(120deg, transparent 45%, rgba(255,235,170,0.08) 48%, rgba(255,235,170,0.12) 50%, rgba(255,235,170,0.08) 52%, transparent 55%),
    radial-gradient(circle at 25% 60%, rgba(255,220,130,0.2), transparent 30%),
    radial-gradient(circle at 75% 45%, rgba(255,215,120,0.15), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(255,250,235,0.3), transparent 60%),
    radial-gradient(ellipse at 30% 80%, rgba(230,220,190,0.2), transparent 35%),
    radial-gradient(ellipse at 70% 15%, rgba(240,235,215,0.15), transparent 30%);
}
.unit-card.faction-soli .card-texture {
  opacity: 0.08;
}

/* Tidehaven — sea-weathered vellum, rippled */
.unit-card.faction-tidehaven {
  background-color: #cce6e3;
  background-image:
    repeating-linear-gradient(
      175deg,
      transparent,
      transparent 14px,
      rgba(120,190,190,0.08) 14px,
      rgba(120,190,190,0.12) 18px,
      transparent 18px,
      transparent 32px
    ),
    radial-gradient(ellipse at 25% 40%, rgba(100,180,175,0.18), transparent 35%),
    radial-gradient(ellipse at 70% 75%, rgba(110,185,180,0.14), transparent 30%),
    radial-gradient(ellipse at 55% 20%, rgba(90,170,165,0.1), transparent 25%),
    radial-gradient(circle at 40% 60%, rgba(220,240,238,0.3), transparent 30%),
    radial-gradient(circle at 80% 30%, rgba(215,235,232,0.25), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(140,200,195,0.12), transparent 60%);
}
.unit-card.faction-tidehaven .card-texture {
  filter: url(#noise-ripple);
  opacity: 0.14;
  mix-blend-mode: multiply;
}

/* Stonehart — rough stone tablet, cold */
.unit-card.faction-stonehart {
  background-color: #d5d5d3;
  background-image:
    linear-gradient(35deg, transparent 48%, rgba(120,115,110,0.08) 49%, rgba(100,95,90,0.1) 50%, rgba(120,115,110,0.08) 51%, transparent 52%),
    linear-gradient(155deg, transparent 46%, rgba(110,105,100,0.06) 48%, rgba(95,90,85,0.08) 49%, transparent 51%),
    linear-gradient(80deg, transparent 44%, rgba(115,110,105,0.05) 47%, rgba(100,95,90,0.07) 48%, transparent 51%),
    radial-gradient(ellipse at 30% 25%, rgba(190,188,185,0.3), transparent 40%),
    radial-gradient(ellipse at 70% 75%, rgba(175,173,170,0.25), transparent 35%),
    radial-gradient(ellipse at 50% 50%, rgba(185,183,180,0.2), transparent 50%),
    radial-gradient(ellipse at 50% 50%, transparent 50%, rgba(140,138,135,0.1) 100%);
}
.unit-card.faction-stonehart .card-texture {
  filter: url(#noise-stone);
  opacity: 0.2;
  mix-blend-mode: multiply;
}

/* Primordial Mists — ancient silk, swirling fog */
.unit-card.faction-primordial-mists {
  background-color: #dccde8;
  background-image:
    radial-gradient(ellipse at 20% 30%, rgba(200,180,230,0.3), transparent 45%),
    radial-gradient(ellipse at 80% 60%, rgba(190,170,220,0.25), transparent 40%),
    radial-gradient(ellipse at 50% 80%, rgba(210,190,240,0.2), transparent 35%),
    radial-gradient(ellipse at 65% 15%, rgba(195,175,225,0.22), transparent 38%),
    radial-gradient(ellipse at 50% 45%, rgba(240,235,250,0.4), transparent 35%),
    radial-gradient(circle at 10% 90%, rgba(120,80,160,0.1), transparent 30%),
    radial-gradient(circle at 90% 10%, rgba(130,90,170,0.08), transparent 25%),
    radial-gradient(ellipse at 50% 50%, rgba(220,210,240,0.15), transparent 70%);
}
.unit-card.faction-primordial-mists .card-texture {
  filter: url(#noise-ethereal);
  opacity: 0.12;
  mix-blend-mode: soft-light;
}

/* Dusters — sandpaper, wind-swept */
.unit-card.faction-dusters {
  background-color: #e8dece;
  background-image:
    repeating-linear-gradient(
      165deg,
      transparent,
      transparent 20px,
      rgba(200,175,140,0.06) 20px,
      rgba(200,175,140,0.1) 23px,
      transparent 23px,
      transparent 43px
    ),
    radial-gradient(ellipse at 25% 20%, rgba(240,225,200,0.35), transparent 35%),
    radial-gradient(ellipse at 75% 70%, rgba(215,195,165,0.25), transparent 30%),
    radial-gradient(ellipse at 50% 45%, rgba(225,210,185,0.2), transparent 40%),
    radial-gradient(circle at 60% 15%, rgba(235,220,195,0.2), transparent 25%),
    radial-gradient(circle at 35% 80%, rgba(180,160,130,0.12), transparent 25%),
    radial-gradient(circle at 80% 40%, rgba(175,155,125,0.1), transparent 20%),
    linear-gradient(180deg, rgba(240,225,200,0.1) 0%, rgba(210,190,160,0.08) 100%);
}
.unit-card.faction-dusters .card-texture {
  filter: url(#noise-sand);
  opacity: 0.16;
  mix-blend-mode: multiply;
}

/* Down Town — modern cardstock, faintly gridded, pale green */
.unit-card.faction-down-town {
  background-color: #d6e8d8;
  background-image:
    repeating-linear-gradient(
      0deg,
      transparent,
      transparent 23px,
      rgba(140,170,145,0.06) 23px,
      rgba(140,170,145,0.06) 24px
    ),
    repeating-linear-gradient(
      90deg,
      transparent,
      transparent 23px,
      rgba(140,170,145,0.06) 23px,
      rgba(140,170,145,0.06) 24px
    ),
    radial-gradient(ellipse at 30% 30%, rgba(220,235,222,0.3), transparent 40%),
    radial-gradient(ellipse at 70% 65%, rgba(210,228,212,0.25), transparent 35%),
    radial-gradient(ellipse at 50% 50%, rgba(215,230,218,0.15), transparent 50%);
}
.unit-card.faction-down-town .card-texture {
  opacity: 0.06;
}

/* ═══════════════════════════════════════════════════════════════
   SHARED: Dark + Gem themes — gold-on-black card styling
   ═══════════════════════════════════════════════════════════════ */

/* Card body: near-black, gold border, no parchment */
body.theme-dark .unit-card,
body.theme-gem .unit-card {
  background-color: #1a1a1a;
  background-image: none;
  border: 1.5px solid #c5a64e;
  border-radius: 4px;
  box-shadow:
    0 4px 20px rgba(0,0,0,0.6),
    inset 0 0 0 0.5px rgba(197,166,78,0.3);
}

body.theme-dark .unit-card .card-texture,
body.theme-gem .unit-card .card-texture { opacity: 0; }

/* Notched frame → straight gold border */
body.theme-dark .card-notched::after,
body.theme-gem .card-notched::after {
  clip-path: none;
  border: 1px solid #c5a64e;
  border-radius: 2px;
  box-shadow: none;
}

body.theme-dark .card-notched::before,
body.theme-gem .card-notched::before { background: none; }

/* Title bar */
body.theme-dark .unit-card .card-header,
body.theme-gem .unit-card .card-header {
  background: #f0ede6;
  border-bottom: 1px solid #c5a64e;
}

body.theme-dark .unit-card .card-name,
body.theme-gem .unit-card .card-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-dark .unit-card .card-cost,
body.theme-gem .unit-card .card-cost {
  background: #1a1a1a;
  border: 1px solid #c5a64e;
  color: #c5a64e;
  box-shadow: none;
}

/* Art area */
body.theme-dark .unit-card .card-image,
body.theme-gem .unit-card .card-image {
  background: #f5f3ef;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
}

/* Stats bar */
body.theme-dark .unit-card .card-stats,
body.theme-gem .unit-card .card-stats {
  background: #1a1a1a;
  border-top: 1px solid #c5a64e;
  border-bottom: 1px solid #c5a64e;
  padding: 1px 0;
}

body.theme-dark .stat-icon path,
body.theme-dark .stat-icon polygon,
body.theme-dark .stat-icon circle,
body.theme-dark .stat-icon line,
body.theme-gem .stat-icon path,
body.theme-gem .stat-icon polygon,
body.theme-gem .stat-icon circle,
body.theme-gem .stat-icon line {
  stroke: rgba(197,166,78,0.8) !important;
}

body.theme-dark .stat-num,
body.theme-gem .stat-num {
  fill: #f0ede6;
  stroke: rgba(26,26,26,0.9);
}

/* Rules area */
body.theme-dark .unit-card .card-rules {
  background: #e8e6e0;
  border-top: 1px solid #c5a64e;
  color: #1a1a1a;
}
body.theme-gem .unit-card .card-rules {
  background: #e4e8ea;
  border-top: 1px solid #c5a64e;
  color: #1a1a1a;
}

body.theme-dark .unit-card .rule-name,
body.theme-gem .unit-card .rule-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-dark .unit-card .rule-desc,
body.theme-gem .unit-card .rule-desc { color: #333; }

/* Bottom diamond accent */
body.theme-dark .unit-card::after,
body.theme-gem .unit-card::after {
  content: '';
  position: absolute;
  bottom: 6px;
  left: 50%;
  width: 10px;
  height: 10px;
  background: #c5a64e;
  transform: translateX(-50%) rotate(45deg);
  z-index: 3;
  border: 0.5px solid rgba(255,255,255,0.2);
}

/* Suppress faction backgrounds */
body.theme-dark .unit-card[class*="faction-"],
body.theme-gem .unit-card[class*="faction-"] {
  background-color: #1a1a1a;
  background-image: none;
}

body.theme-dark .unit-card[class*="faction-"] .card-texture,
body.theme-gem .unit-card[class*="faction-"] .card-texture { opacity: 0; }

/* ═══════════════════════════════════════════════════════════════
   THEME-SPECIFIC: Dark — art deco corner flourishes
   ═══════════════════════════════════════════════════════════════ */

body.theme-dark .unit-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  background:
    conic-gradient(
      from 180deg at 0% 0%,
      transparent 0deg, #c5a64e 1deg, transparent 3deg,
      transparent 8deg, #c5a64e 9deg, transparent 11deg,
      transparent 16deg, #c5a64e 17deg, transparent 19deg,
      transparent 24deg, #c5a64e 25deg, transparent 27deg,
      transparent 32deg, #c5a64e 33deg, transparent 35deg,
      transparent 40deg, #c5a64e 41deg, transparent 43deg,
      transparent 48deg, #c5a64e 49deg, transparent 51deg,
      transparent 56deg, #c5a64e 57deg, transparent 59deg,
      transparent 64deg, #c5a64e 65deg, transparent 67deg,
      transparent 72deg, #c5a64e 73deg, transparent 75deg,
      transparent 80deg, #c5a64e 81deg, transparent 83deg,
      transparent 88deg, #c5a64e 89deg, transparent 91deg,
      transparent 360deg
    ),
    conic-gradient(
      from 270deg at 100% 0%,
      transparent 0deg, #c5a64e 1deg, transparent 3deg,
      transparent 8deg, #c5a64e 9deg, transparent 11deg,
      transparent 16deg, #c5a64e 17deg, transparent 19deg,
      transparent 24deg, #c5a64e 25deg, transparent 27deg,
      transparent 32deg, #c5a64e 33deg, transparent 35deg,
      transparent 40deg, #c5a64e 41deg, transparent 43deg,
      transparent 48deg, #c5a64e 49deg, transparent 51deg,
      transparent 56deg, #c5a64e 57deg, transparent 59deg,
      transparent 64deg, #c5a64e 65deg, transparent 67deg,
      transparent 72deg, #c5a64e 73deg, transparent 75deg,
      transparent 80deg, #c5a64e 81deg, transparent 83deg,
      transparent 88deg, #c5a64e 89deg, transparent 91deg,
      transparent 360deg
    );
  -webkit-mask-image:
    radial-gradient(circle at 0% 0%, black 0%, transparent 22%),
    radial-gradient(circle at 100% 0%, black 0%, transparent 22%);
  -webkit-mask-composite: source-over;
  mask-image:
    radial-gradient(circle at 0% 0%, black 0%, transparent 22%),
    radial-gradient(circle at 100% 0%, black 0%, transparent 22%);
  mask-composite: add;
}

/* ═══════════════════════════════════════════════════════════════
   THEME-SPECIFIC: Gem CSS — gold L-brackets at corners
   ═══════════════════════════════════════════════════════════════ */

body.theme-gem .unit-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  background:
    linear-gradient(90deg, #c5a64e 18px, transparent 18px) no-repeat 3px 3px / 20px 1.5px,
    linear-gradient(180deg, #c5a64e 18px, transparent 18px) no-repeat 3px 3px / 1.5px 20px,
    linear-gradient(270deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) 3px / 20px 1.5px,
    linear-gradient(180deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) 3px / 1.5px 20px,
    linear-gradient(270deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) calc(100% - 3px) / 20px 1.5px,
    linear-gradient(0deg, #c5a64e 18px, transparent 18px) no-repeat calc(100% - 3px) calc(100% - 3px) / 1.5px 20px,
    linear-gradient(90deg, #c5a64e 18px, transparent 18px) no-repeat 3px calc(100% - 3px) / 20px 1.5px,
    linear-gradient(0deg, #c5a64e 18px, transparent 18px) no-repeat 3px calc(100% - 3px) / 1.5px 20px;
}

/* ═══════════════════════════════════════════════════════════════
   THEME: Gem Image — actual gemBG.png as background
   Activated by body.theme-gem-img
   ═══════════════════════════════════════════════════════════════ */

body.theme-gem-img .unit-card {
  background: #0a0a0a;
  border: none;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

body.theme-gem-img .unit-card .card-texture { opacity: 0; }

body.theme-gem-img .unit-card::before { display: none; }

/* Frame overlay — bgBlack sits on top of the unit image */
body.theme-gem-img .unit-card::after {
  content: '';
  display: block;
  position: absolute;
  inset: 0;
  background: url('../nandeck/images/bgblack2.png') center / cover no-repeat;
  z-index: 2;
  pointer-events: none;
}

/* Unit image behind the frame */
body.theme-gem-img .unit-card .card-image {
  z-index: 0;
}

/* Text content above the frame */
body.theme-gem-img .unit-card .card-header,
body.theme-gem-img .unit-card .card-stats,
body.theme-gem-img .unit-card .card-conditions-bar,
body.theme-gem-img .unit-card .card-rules {
  z-index: 3;
}

body.theme-gem-img .unit-card.card-dead::after { display: none; }
body.theme-gem-img .card-notched::after { display: none; }
body.theme-gem-img .card-notched::before { display: none; }

body.theme-gem-img .unit-card .card-header {
  background: transparent;
}

body.theme-gem-img .unit-card .card-name {
  color: #f0ede6;
  text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}

body.theme-gem-img .unit-card .card-cost {
  background: transparent;
  border: none;
  color: #000000;
  box-shadow: none;
  font-size: 15px;
}

body.theme-gem-img .unit-card .card-image {
  background: transparent;
}

body.theme-gem-img .unit-card .card-image img {
  object-fit: contain;
}

body.theme-gem-img .unit-card .card-stats {
  background: transparent;
  margin-top: 0;
  padding: 2px 4px;
  min-height: 30px;
  align-items: center;
  margin-top:-7px;
}

body.theme-gem-img .stat-icon {
  width: 28px;
  height: 28px;
}

body.theme-gem-img .stat-icon path,
body.theme-gem-img .stat-icon polygon,
body.theme-gem-img .stat-icon circle,
body.theme-gem-img .stat-icon line {
  stroke: rgba(197,166,78,0.8) !important;
}

body.theme-gem-img .stat-num {
  fill: #f0ede6;
  stroke: rgba(26,26,26,0.9);
  font-size: 20px;
  stroke-width: 2px;
}

body.theme-gem-img .unit-card .card-rules {
  background: transparent;
  color: #1a1a1a;
}

body.theme-gem-img .unit-card .rule-name {
  color: #1a1a1a;
  text-shadow: none;
}

body.theme-gem-img .unit-card .rule-desc {
  color: #333;
}

body.theme-gem-img .unit-card[class*="faction-"] {
  background: #0a0a0a;
  background-image: none;
}

body.theme-gem-img .unit-card[class*="faction-"] .card-texture {
  opacity: 0;
}

/* ═══════════════════════════════════════════════════════════════
   Enlarged inspect card (Ctrl+hover) — 2× base card
   Placed AFTER all themes so overrides win. Uses `body` prefix
   for specificity (0,3,1+) to beat theme selectors.
   ═══════════════════════════════════════════════════════════════ */

body .unit-card.enlarged {
  width: 480px;
  height: 672px;
  padding: 12px 16px 10px;
  gap: 0;
  z-index: 500;
  pointer-events: none;
}
body .unit-card.enlarged .card-header { padding: 6px 36px; margin-bottom: 4px; }
body .unit-card.enlarged .card-name { font-size: 22px; }
body .unit-card.enlarged .card-cost { font-size: 24px; left: 6px; width: 36px; height: 36px; }
body .unit-card.enlarged .card-stats {margin-top: -15px; padding: 2px 0; }
body .unit-card.enlarged .card-stats svg { width: 55px; height: 55px; }
body .unit-card.enlarged .card-type { font-size: 16px; padding: 6px 14px; }
body .unit-card.enlarged .card-rules { padding: 8px 14px; font-size: 16px; margin-top: 2px; }
body .unit-card.enlarged .rule-name { font-size: 16px; }
body .unit-card.enlarged .rule-desc { font-size: 14px; }
body .unit-card.enlarged .card-conditions-bar { display: none; }

/* ── Condition panel (to the left of enlarged card) ──────────── */

.card-conditions {
  position: fixed;
  z-index: 501;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 8px;
  min-width: 120px;
}

.card-cond-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-cond-icon {
  position: relative;
  width: 26px;
  height: 26px;
  border-radius: 4px;
  border: 1px solid rgba(255,255,255,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  color: #fff;
  flex-shrink: 0;
  text-shadow: 0 0 3px rgba(0,0,0,0.8);
}

.card-cond-label {
  color: #ddd;
  font-size: 13px;
  font-weight: 600;
  text-transform: capitalize;
}

